
# Реализованная функциональность
<ul>
    <li> Прогнозирование прироста денег в терминалах на каждый день горизонта планирования</li>
    <li> Выбор оптимальных маршрутов для броневиков на каждый день горизонта планирования </li>
    <li> Оптимизационная модель для оценки минимального количества броневиков</li>
    <li> Гибкая настройка параметров расчета </li>
</ul> 

# Прогнозная модель


# Оптимизационная модель

В файле **create_data.py** реализованы 2 функции:  

1. **create_data** читает входные данные на первый день горизонта планирования  
2. **update_data** обновляет данные на каждый день горизонта планирования с учетом решения предыдущего дня
  
Кроме того, для каждого терминала в этих функциях вычисляется параметр *DaysLeft*, который показывает, через сколько дней посещение терминала станет обязательным (истечет период непосещения 14 дней или прогнозируется объем наличных в терминале, превышающий 1000000 рублей). 

В файле **routes_generation.py** реализован алгоритм генерации фиксированного количества потенциальных маршрутов на текущий день расчета:

1. Первая точка маршрута выбирается случайным образом, но вероятность выпадения терминала увеличивается при меньшем параметре *DaysLeft*.
2. Последующие точки выбираются также случайным образом, но на вероятность выпадения терминала влияет параметр *DaysLeft* и *EdgeTime* (время проезда между предыдущей точкой маршрута и потенциальным кандидатом). Чем ниже показатели *DaysLeft* и *EdgeTime*, тем выше вероятность выпадения терминала.
3. При генерации последующих потенциальных точек маршрута исключаются все предыдущие терминалы, а также терминалы, до которых невозможно доехать до конца рабочей смены.
4. Маршрут генерируется до тех пор, пока множество потенциальных следующих точек не окажется пустым.

В файле **model.py** с помощью библиотеки **Pyomo** описана модель линейного целочисленного программирования:

**Переменные**

*route_use[r]* - бинарные переменные, показывающие, выбрали ли мы сгенерированный маршрут r в текущий день. 
   
**Ограничения**

1. Обязательно объехать терминалы с *DaysLeft* = 0
2. Не посещать терминал более 1 раза за день
3. Количество выбранных *route_use* должно не превышать заданное количество броневиков
   
**Целевая функция**

Суммарное количество баллов за посещение терминалов с *DaysLeft* > 0. Чем меньше *DaysLeft* терминала, тем больше баллов в целевую функцию пойдет за его посещение. Такой выбор целевой функции позволяет нам заблаговременно посещать некоторые терминалы, что позволит избежать неразрешимости задачи по объезду терминалов с *DaysLeft* = 0 в последующие дни.

Файл **output.py** собирает результаты работы оптимизационной модели текущего дня в нужном формате.

Файл **main.py** запускает цикл по всему горизонту планирования, в котором:

1. Обновляются данные с учетом предыдущего дня
2. Генерируются потенциальные маршруты
3. Решается оптимизационная задача по выбору маршрутов с помощью open-source солвера HIGHS
4. Резльутат добавляется в выходной отчет

Также в этом файле определяются гиперпараметры расчета:

1. params['balance_percent'] - величина % в годовых, которую банк платит за неинкассированную сумму денег в терминале
2. params['maintenance_percent'] - величина % от суммы инкассации за обслуживание терминала
3. params['car_cost'] - стоимость одного броневика за день
4. params['max_cash'] - максимально допустимая сумма денег в терминале
5. params['max_days'] - максимально допустимое время, в течение которого терминал можно не обслуживать
6. params['maintenance_minutes'] - время на обсулживание одного терминала
7. params['start_hour'] - время началы смены
8. params['end_hour'] - время конца смены
9. params['start_date'] - первая дата горизонта планирования
10. params['end_date'] - последняя дата горизонта планирования
11. params['num_cars'] - размер парка броневиков. Данный параметр передается как ограничение на каждый запуск оптимизации. Если в один из дней горизонта планирования статус оптимизации окажется "нет решения", значит выбранного размера парка не хватает. На предоставленных данных был подобран минимальный параметр params['num_cars'] = 8, при котором удавалось построить допустимое расписание на 3 месяца.
 
### Запуск решения
<ul>
<li>Запустить код create_opt_data.py - подготовка данных</li>
<li>Запустить код create_dat_file.py - передача данных в оптмизацию</li>	
<li>Запустить основной код main_call.py - запуск оптимизационной задачи </li>
</ul>
